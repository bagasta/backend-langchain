# RAG Performance Optimization Configuration
# Copy this to .env and customize as needed

# ===== INDEX OPTIMIZATION =====
# Enable HNSW indexes for high-dimensional vectors (recommended for >1536 dims)
RAG_HNSW_ENABLED=true

# HNSW index parameters
RAG_HNSW_M=16                    # Higher values = better accuracy but more memory
RAG_HNSW_EF_CONSTRUCTION=64       # Higher values = better index quality but slower build
RAG_HNSW_EF_SEARCH=40             # Higher values = better search accuracy but slower queries

# IVFFLAT index parameters (fallback for lower dimensions)
RAG_IVFFLAT_MAX_DIM=2000         # Maximum dimension for IVFFLAT before switching to HNSW
RAG_INDEX_OPS=vector_cosine_ops   # Distance operator for vector operations

# ===== ADAPTIVE CONFIGURATION =====
# Enable adaptive probe count based on dataset size
RAG_ADAPTIVE_PROBES=true

# Probe configuration for IVFFLAT indexes
RAG_IVFFLAT_PROBES=1             # Base probe count (will adapt if adaptive_probes=true)
RAG_MAX_PROBES=10                # Maximum probe count for large datasets

# ===== CONNECTION POOLING =====
# Connection pool settings for vector database operations
RAG_CONNECTION_POOL_MIN=2        # Minimum connections in pool
RAG_CONNECTION_POOL_MAX=10       # Maximum connections in pool
RAG_CONNECTION_POOL_TIMEOUT=30    # Connection timeout in seconds

# ===== CACHING =====
# Embedding cache settings
RAG_EMBED_CACHE_TTL_SECONDS=900   # Embedding cache TTL (15 minutes)
RAG_EMBED_CACHE_MAX=1024         # Maximum embeddings to cache (increased from 512)

# Query result cache settings
RAG_QUERY_CACHE_TTL_SECONDS=300   # Query cache TTL (5 minutes)
RAG_QUERY_CACHE_MAX=1000         # Maximum queries to cache

# Redis configuration for distributed caching
RAG_REDIS_URL=redis://localhost:6379/0
RAG_REDIS_TTL=3600                # Redis cache TTL (1 hour)

# ===== PERFORMANCE SETTINGS =====
# Query timeout settings
RAG_STATEMENT_TIMEOUT_MS=2000     # Default query timeout
RAG_FULLSCAN_TIMEOUT_MS=8000      # Timeout for full table scans

# OpenAI embedding optimization
OPENAI_EMBEDDING_TIMEOUT=1        # Embedding request timeout
OPENAI_EMBEDDING_MAX_RETRIES=0    # Embedding retry attempts

# ===== MONITORING AND DEBUGGING =====
# RAG system logging
RAG_LOG_LEVEL=INFO               # Log level: DEBUG, INFO, WARNING, ERROR

# Performance logging
RAG_LOG_CONTEXT=true             # Log retrieved context snippets
RAG_LOG_SYSTEM_MESSAGE=true       # Log system messages in responses

# Index and query optimization
RAG_ENSURE_INDEX=true            # Auto-create indexes
RAG_ANALYZE=true                 # Run ANALYZE after index creation
RAG_DISABLE_SEQSCAN=true         # Disable sequential scans when index available

# Warmup and initialization
RAG_WARM_ON_START=true           # Warm up clients on startup
RAG_WARM_TEXT="Warmup token"     # Text for embedding warmup

# ===== PARALLEL PROCESSING =====
RAG_PARALLEL_QUERIES=1            # Number of parallel queries (future enhancement)

# ===== ACCURACY TUNING =====
# Similarity threshold for RAG results
RAG_MIN_SIMILARITY=0.2           # Minimum similarity score to include result

# Result limits and filtering
RAG_TOP_K=3                      # Default number of results to return
RAG_MAX_PROMPT_TOKENS=2000       # Maximum tokens in RAG-augmented prompts
RAG_SNIPPET_PREVIEW_CHARS=200     # Characters in preview snippets